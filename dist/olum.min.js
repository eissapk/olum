/**
* @name Olum.js
* @version 1.0.0
* @copyright 2021
* @author Eissa Saber
* @license MIT
*/
"use strict";var _this=void 0;function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(_getRequireWildcardCache=function(e){return e?n:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,r,o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=i?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(o,n,r):o[n]=e[n]);return o.default=e,t&&t.set(e,o),o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){if("object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var n,r=t();for(n in r)e[n]=r[n]}}("undefined"!=typeof self?self:void 0,function(){function i(){return!!["localhost","127.0.0.1"].includes(location.hostname)}function t(e){return!(null===e||"object"!==_typeof(e))}function c(e){return!!(t(e)&&Array.isArray(e)&&e.length)}function s(e){return!!(t(e)&&Array.isArray(Object.keys(e))&&Object.keys(e).length)}function u(e){return!(null==e)}function l(e,t){return!!e.hasOwnProperty(t)}function h(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}function f(e){var t="err"==(t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"log")?"error":t}var p="undefined"!=typeof self?self:_this,d="Olum [warn]:",y=function(e){return"“"+e+"”"},v="".concat(d," ").concat(y("devtool extension")," is not installed!\n  \nto install it please download ").concat(y("devtool.js")," from the official repo\n  \n@ https://github.com/eissapk/Olum/blob/master/devtool.js\n  \nand save it in the root of your project");String.prototype.upper=function(){return this.toUpperCase()},String.prototype.lower=function(){return this.toLowerCase()},String.prototype.cap=function(){return this.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")};function o(n,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document;return"string"!=typeof n?(!Array.isArray(n)&&n&&n instanceof Element&&(n.get=function(e,t){return o(e,t,n)}),n):(t=[].slice.call(t.querySelectorAll(n)),c(t)?e?t:t[0]:e?[]:null)}function e(e,t){return this.addEventListener(e,t,2<arguments.length&&void 0!==arguments[2]&&arguments[2])}function n(e,t){return this.removeEventListener(e,t,2<arguments.length&&void 0!==arguments[2]&&arguments[2])}Element.prototype.on=e,Element.prototype.off=n,Document.prototype.on=e,Document.prototype.off=n,p.on=e,p.off=n;Element.prototype.toggle=function(){var e,t=this;this.style.transition="height ".concat(0<arguments.length&&void 0!==arguments[0]?arguments[0]:.3,"s ease-in-out"),0==this.clientHeight?(this.style.height="auto",e=this.clientHeight+"px",this.style.height="0",setTimeout(function(){return t.style.height=e},0)):this.style.height="0"};var r=function(){function e(){var t=this;_classCallCheck(this,e),_defineProperty(this,"get",function(e){return t.req("GET",e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}),_defineProperty(this,"post",function(e){return t.req("POST",e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}),_defineProperty(this,"delete",function(e){return t.req("DELETE",e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}),_defineProperty(this,"put",function(e){return t.req("PUT",e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}),_defineProperty(this,"patch",function(e){return t.req("PATCH",e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}),this instanceof e||console.error("".concat(d," can't invoke ").concat(y("Origin constructor")," without new keyword")),this.xhr=new XMLHttpRequest}return _createClass(e,[{key:"setParams",value:function(e){if(s(e)){for(var t in e)"body"!==t&&this.xhr.setRequestHeader(t,e[t]);return l(e,"body")&&s(e.body)?JSON.stringify(e.body):null}}},{key:"onload",value:function(t,e){var n=this;return this.xhr.onreadystatechange=function(){if(4===n.xhr.readyState)if(0===n.xhr.status||200<=n.xhr.status&&n.xhr.status<=299)try{t(JSON.parse(n.xhr.responseText))}catch(e){t(n.xhr.responseText)}else 400<=n.xhr.status&&n.xhr.status<=599&&e("".concat(d," couldn't reach the server"))}}},{key:"req",value:function(r,o){var i=this,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(e,t){i.xhr.open(r,o,!0);var n=i.setParams(a);i.onload(e,t),i.xhr.onerror=function(){return t("".concat(d," network error"))},null!==n?i.xhr.send(n):i.xhr.send()})}}]),e}();return{Olum:function(){function a(e){var t=e.mode,n=e.root,r=e.el,o=e.prefix,i=e.err,e=e.routes;_classCallCheck(this,a),_defineProperty(this,"routes",[]),_defineProperty(this,"views",[]),_defineProperty(this,"pushStateAPI",!!p.history.pushState),this instanceof a||console.error("".concat(d," can't invoke ").concat(y("Olum constructor")," without new keyword")),this.setMode(t),this.setRoot(n),this.setPrefix(o),this.setErr(i),this.hasRootElm(r)?this.hasRoutes(e)?(this.buildStyles(),this.popStateEvent=new PopStateEvent("popstate"),this.listen()):console.error("".concat(d," couldn't find ").concat(y("routes property")," @ router instance or it's empty. \nmake sure that ").concat(y("routes property"),' has components \ne.g. routes = [{ path: "/", comp: Home }]')):console.error("".concat(d," couldn't find a value for ").concat(y("el property"),' @ router instance. \nmake sure it has the right selector e.g. el:"#app" \nand ').concat(y("Root Element"),' exists in dom e.g. <div id="app"></div>'))}return _createClass(a,[{key:"hasRootElm",value:function(e){var t=document.querySelector(e);return!(!e||!t)&&(this.rootCompName=e.replace(/\#|\./,"").cap(),this.appMarkup=t,!0)}},{key:"hasRoutes",value:function(e){var t=this;return!(!e||!c(e))&&(e.forEach(function(e){t.views.push(e.comp),t.addRoute(e.path,e.comp)}),!0)}},{key:"setPrefix",value:function(e){e?this.prefix=e:(this.prefix=null,console.warn("".concat(d," couldn't find ").concat(y("prefix property")," @ router instance. \nfalling back to default component tag e.g. <ComponentName/>")))}},{key:"setRoot",value:function(e){e?this.root=e:(this.root="/",console.warn("".concat(d," couldn't find ").concat(y("root property")," @ router instance. \nfalling back to default value: ").concat(y("/"))))}},{key:"setErr",value:function(e){e?this.err=this.resolve(e):(this.err=null,console.warn("".concat(d," couldn't find ").concat(y("err property")," @ router instance. \nfalling back to default 404 page")))}},{key:"setMode",value:function(e){e?this.pushStateAPI?this.mode=e:(this.mode="hash",console.warn("".concat(d," mode is set to ").concat(y("hash")," \n").concat(y("history")," is not supported!"))):(this.mode=this.pushStateAPI?"history":"hash",console.warn("".concat(d," couldn't find ").concat(y("mode property")," @ router instance. \nfalling back to available default mode: ").concat(y(this.mode))))}},{key:"addRoute",value:function(e,t){var n=this;this.routes.push({path:this.resolve(e),cb:function(){return n.inject(t)}})}},{key:"delRoute",value:function(n){var r=this;this.routes.forEach(function(e){var t;e.path===r.resolve(n)&&(t=r.routes,e=e,t.length&&-1<t.indexOf(e)&&t.splice(t.indexOf(e),1))})}},{key:"flush",value:function(){this.routes=[]}},{key:"resolve",value:function(e){var t=this.clear(this.root);return e=this.clear(e),e="/"!==(e="/"!==this.root?"/"+t+"/"+e:"/"+e)?e.replace(/\/$/g,""):e}},{key:"clear",value:function(e){var t=new RegExp("^[#/]{1,}|/$","g");return e=e.lower().trim().replace(t,"")}},{key:"listen",value:function(){var o=this;p.on("popstate",function(){f(["Dispatched Popstate",o.routes]);var e,t=o.getRoute(),n="/"+o.clear(o.root),t="hash"===o.mode&&"/"!==o.root?(t=n+t).replace(/\/$/,""):t,r=o.routes.find(function(e){return e.path===t?e:""===t||"/"===t||t.includes("index.html")?e.path===n:void 0});u(r)?(r.cb(),o.active(r)):u(o.err)?(e=o.routes.find(function(e){return e.path===o.err}),u(e)?e.cb():console.error("".concat(d," unmached path of ").concat(y("err property")," @ router instance."))):o.appMarkup.innerHTML="Not Found!",f({current:t,route:r})}),dispatchEvent(this.popStateEvent)}},{key:"getRoute",value:function(){var e="";return"history"===this.mode?e=this.clear(decodeURI(location.pathname)):"hash"===this.mode&&(e=this.clear(decodeURI(location.hash))),"/"+e}},{key:"navigate",value:function(e){var t;e=this.resolve(e),"history"===this.mode?(p.history.pushState({},"",e),f("Pushed to history"),dispatchEvent(this.popStateEvent)):"hash"===this.mode&&("/"===this.root?location.href="".concat(location.href.replace(/\#.*/g,""),"#").concat(e):(t=(t=this.clear(this.root)).replace(/\//g,"\\/"),t=new RegExp("\\/".concat(t),"g"),t="/"+(t=e.replace(t,"")).replace(/^\//g,""),location.href="".concat(location.href.replace(/\#.*/g,""),"#").concat(t)))}},{key:"to",value:function(){var r=this,e=o("[to]",!0);c(e)&&e.forEach(function(e){"A"===e.nodeName&&e.setAttribute("href","javascript:void(0)"),_toConsumableArray(e.children).forEach(function(e){return e.style.pointerEvents="none"}),e.on("click",function(e){var t=e.target.getAttribute("to"),n=r.resolve(t),e=r.getRoute();n!==e&&r.navigate(t)})})}},{key:"active",value:function(t){var n=this,e=o("[to]",!0);c(e)&&e.forEach(function(e){n.resolve(e.getAttribute("to"))===t.path?e.classList.add("active"):e.classList.remove("active")})}},{key:"buildTree",value:function(e){var o=[];return function e(t){if(l(t,"components")&&s(t.components))for(var n in t.components){var r={};h(r,"parent",t.name),h(r,"child",{}),h(r.child,"name",n);n=new t.components[n];h(r.child,"data",n.data()),o.push(r),l(r,"child")&&l(r.child,"data")&&e(r.child.data)}}(e),f(["compsArr",o]),o}},{key:"inject",value:function(e){var n,r,t,o=this;e&&"function"==typeof e?(n=(new e).data(),r=this.buildTree(n),t=function(e){var e=e?e.label(n,r):{entry:n,compsArr:r},t=o.merge(e);o.appMarkup.innerHTML=t.template,setTimeout(function(){for(var e in o.to(),t.script)t.script[e]()},0)},i()?Promise.resolve().then(function(){return _interopRequireWildcard(require("/devtool.js"))}).then(function(e){e=new e.default(o.appMarkup,o.rootCompName);t(e)}).catch(function(){return console.warn(v)}):t()):console.error("".concat(d," ").concat(y("View argument")," is missing or it's not a constructor function! @ Olum.inject(View)"))}},{key:"buildStyles",value:function(){var n=this,r=[];this.views.forEach(function(e){var t=(new e).data(),e=n.buildTree(t),t=t.style||"";r.push(t),e.forEach(function(e){l(e.child,"data")&&(e=e.child.data.style||"",r.push(e.trim()))})});var e=_toConsumableArray(new Set(r));document.head.insertAdjacentHTML("beforeend","<style>".concat(e.join(""),"</style>"))}},{key:"merge",value:function(e){var o=this,t=e.entry,e=e.compsArr,i=t.template||"",a={};return t.render&&(a[0]=t.render),c(e)&&e.forEach(function(e,t){var n=e.child.data,r=n.template||"",e=n.render||null,n=null!==o.prefix?o.prefix+"-"+n.name:n.name,n=new RegExp("<(".concat(n,"\\s{0,})\\/>"),"gi");i=i.replace(n,r),null!==e&&(a[t+1]=e)}),{template:i,script:a}}}]),a}(),Service:function(){function t(e){return _classCallCheck(this,t),this instanceof t||console.error("".concat(d," can't invoke ").concat(y("Service constructor")," without new keyword")),this.event=e,this.init(),this}return _createClass(t,[{key:"init",value:function(){this.serviceEvent=new CustomEvent(this.event,{detail:{},bubbles:!0,cancelable:!0,composed:!1})}},{key:"trigger",value:function(){u(this.serviceEvent)&&dispatchEvent(this.serviceEvent)}}]),t}(),Origin:r,$:o,debug:function(e){var t,n="err"==(n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"log")?"error":n;i()&&(Array.isArray(e)?(t=console)[n].apply(t,_toConsumableArray(e)):console[n](e))},setTemp:function(e,t){var n,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["{{","}}"];for(n in t)e=e.replace(new RegExp("\\".concat(r[0][0],"\\").concat(r[0][1]).concat(n,"\\").concat(r[1][0],"\\").concat(r[1][1]),"g"),t[n]);return e}}});