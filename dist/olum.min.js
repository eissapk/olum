/**
* @name Olum.js
* @version 0.1.2
* @copyright 2021
* @author Eissa Saber
* @license MIT
*/
"use strict";var _this=void 0;function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var r,o,n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&((o=a?Object.getOwnPropertyDescriptor(e,r):null)&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]);return n.default=e,t&&t.set(e,n),n}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):(t=t(),e.Olum=t.Olum,e.$=t.$,e.debug=t.debug)}("undefined"!=typeof self?self:void 0,function(){function t(e){return"“"+e+"”"}function a(){return!!["localhost","127.0.0.1"].includes(location.hostname)}function n(e){return!!(h(e)&&Array.isArray(e)&&e.length)}function c(e){return!(null==e)}function u(e,t){return!!e.hasOwnProperty(t)}function s(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0})}function l(e){var t="err"==(t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"log")?"error":t}var p="undefined"!=typeof self?self:_this,f="Olum [warn]:",d="".concat(f," ").concat("“devtool extension”"," is not installed!\n  \nto install it please download ").concat("“devtool.js”"," from the official repo\n  \n@ https://raw.githubusercontent.com/olumjs/olum-devtool/master/devtool.js\n  \nand save it in the root of your project"),h=function(e){return!(null===e||"object"!==_typeof(e))};String.prototype.upper=function(){return this.toUpperCase()},String.prototype.lower=function(){return this.toLowerCase()},String.prototype.cap=function(){return this.toLowerCase().split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1)}).join(" ")};function y(e){var t,r="err"==(r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"log")?"error":r;a()&&(Array.isArray(e)?(t=console)[r].apply(t,_toConsumableArray(e)):console[r](e))}function v(r,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document;return"string"!=typeof r?(!Array.isArray(r)&&r&&r instanceof Element&&(r.get=function(e,t){return v(e,t,r)}),r):(t=[].slice.call(t.querySelectorAll(r)),n(t)?e?t:t[0]:e?[]:null)}function e(e,t){return this.addEventListener(e,t,2<arguments.length&&void 0!==arguments[2]&&arguments[2])}function r(e,t){return this.removeEventListener(e,t,2<arguments.length&&void 0!==arguments[2]&&arguments[2])}return Element.prototype.on=e,Element.prototype.off=r,Document.prototype.on=e,Document.prototype.off=r,p.on=e,p.off=r,{Olum:function(){function i(e){var t=e.mode,r=e.root,o=e.el,n=e.prefix,a=e.err,e=e.routes;_classCallCheck(this,i),_defineProperty(this,"isFrozen",!1),_defineProperty(this,"routes",[]),_defineProperty(this,"pushStateAPI",!!p.history.pushState),this instanceof i||console.error("".concat(f," can't invoke ").concat("“Olum constructor”"," without new keyword")),this.setMode(t),this.setRoot(r),this.setPrefix(n),this.setErr(a),this.hasRootElm(o)?this.hasRoutes(e)?(this.popStateEvent=new PopStateEvent("popstate"),this.viewLoaded=new CustomEvent("viewLoaded",{detail:{},bubbles:!0,cancelable:!0,composed:!1}),this.listen()):console.error("".concat(f," couldn't find ").concat("“routes property”"," @ router instance or it's empty. \nmake sure that ").concat("“routes property”",' has components \ne.g. routes = [{ path: "/", comp: Home }]')):console.error("".concat(f," couldn't find a value for ").concat("“el property”",' @ router instance. \nmake sure it has the right selector e.g. el:"#app" \nand ').concat("“Root Element”",' exists in dom e.g. <div id="app"></div>'))}return _createClass(i,[{key:"hasRootElm",value:function(e){var t=document.querySelector(e);return!(!e||!t)&&(this.rootCompName=e.replace(/\#|\./,"").cap(),this.appMarkup=t,!0)}},{key:"hasRoutes",value:function(e){var t=this;return!(!e||!n(e))&&(e.forEach(function(e){return t.addRoute(e.path,e.comp)}),!0)}},{key:"setPrefix",value:function(e){e?this.prefix=e:(this.prefix=null,y("".concat(f," couldn't find ").concat("“prefix property”"," @ router instance. \nfalling back to default component tag e.g. <ComponentName/>"),"warn"))}},{key:"setRoot",value:function(e){e?this.root=e:(this.root="/",y("".concat(f," couldn't find ").concat("“root property”"," @ router instance. \nfalling back to default value: ").concat("“/”"),"warn"))}},{key:"setErr",value:function(e){e?this.err=this.resolve(e):(this.err=null,y("".concat(f," couldn't find ").concat("“err property”"," @ router instance. \nfalling back to default 404 page"),"warn"))}},{key:"setMode",value:function(e){e?this.pushStateAPI?this.mode=e:(this.mode="hash",y("".concat(f," mode is set to ").concat("“hash”"," \n").concat("“history”"," is not supported!"),"warn")):(this.mode=this.pushStateAPI?"history":"hash",y("".concat(f," couldn't find ").concat("“mode property”"," @ router instance. \nfalling back to available default mode: ").concat(t(this.mode)),"warn"))}},{key:"addRoute",value:function(e,t){var r=this;this.routes.push({path:this.resolve(e),cb:function(){return r.inject(t)}})}},{key:"delRoute",value:function(r){var o=this;this.routes.forEach(function(e){var t;e.path===o.resolve(r)&&(t=o.routes,e=e,t.length&&-1<t.indexOf(e)&&t.splice(t.indexOf(e),1))})}},{key:"flush",value:function(){this.routes=[]}},{key:"resolve",value:function(e){var t=this.clear(this.root);return e=this.clear(e),e="/"!==(e="/"!==this.root?"/"+t+"/"+e:"/"+e)?e.replace(/\/$/g,""):e}},{key:"clear",value:function(e){var t=new RegExp("^[#/]{1,}|/$","g");return e=e.lower().trim().replace(t,"")}},{key:"freeze",value:function(){this.isFrozen=!0}},{key:"unfreeze",value:function(){this.isFrozen=!1}},{key:"listen",value:function(){var n=this;p.on("popstate",function(){l(["Dispatched Popstate",n.routes]);var e,t=n.getRoute(),r="/"+n.clear(n.root),t="hash"===n.mode&&"/"!==n.root?(t=r+t).replace(/\/$/,""):t,o=n.routes.find(function(e){return e.path===t?e:""===t||"/"===t||t.includes("index.html")?e.path===r:void 0});c(o)?n.isFrozen||o.cb():c(n.err)?(e=n.routes.find(function(e){return e.path===n.err}),c(e)?e.cb():console.error("".concat(f," unmached path of ").concat("“err property”"," @ router instance."))):n.appMarkup.innerHTML="Not Found!",l({current:t,route:o})}),dispatchEvent(this.popStateEvent)}},{key:"getRoute",value:function(){var e="";return"history"===this.mode?e=this.clear(decodeURI(location.pathname)):"hash"===this.mode&&(e=this.clear(decodeURI(location.hash))),"/"+e}},{key:"navigate",value:function(e){var t;this.unfreeze(),e=this.resolve(e),"history"===this.mode?(p.history.pushState({},"",e),l("Pushed to history"),dispatchEvent(this.popStateEvent)):"hash"===this.mode&&("/"===this.root?location.href="".concat(location.href.replace(/\#.*/g,""),"#").concat(e):(t=(t=this.clear(this.root)).replace(/\//g,"\\/"),t=new RegExp("\\/".concat(t),"g"),t="/"+(t=e.replace(t,"")).replace(/^\//g,""),location.href="".concat(location.href.replace(/\#.*/g,""),"#").concat(t)))}},{key:"to",value:function(){var o=this,e=v("[to]",!0);n(e)&&e.forEach(function(e){"A"===e.nodeName&&e.setAttribute("href","javascript:void(0)"),_toConsumableArray(e.children).forEach(function(e){return e.style.pointerEvents="none"}),e.on("click",function(e){var t=e.target.getAttribute("to"),r=o.resolve(t),e=o.getRoute();r!==e&&o.navigate(t)})})}},{key:"active",value:function(t){var r=this,e=v("[to]",!0);n(e)&&e.forEach(function(e){r.resolve(e.getAttribute("to"))===t?e.classList.add("active"):e.classList.remove("active")})}},{key:"buildTree",value:function(e){var a=[];return function e(t){if(u(t,"components")&&(n=t.components,!!(h(n)&&Array.isArray(Object.keys(n))&&Object.keys(n).length)))for(var r in t.components){var o={};s(o,"parent",t.name),s(o,"child",{}),s(o.child,"name",r);r=new t.components[r];s(o.child,"data",r.data()),a.push(o),u(o,"child")&&u(o.child,"data")&&e(o.child.data)}var n}(e),l(["compsArr",a]),a}},{key:"inject",value:function(e){var t,r,o,n=this;e&&"function"==typeof e?(t=(new e).data(),r=this.buildTree(t),o=function(e){var e=e?e.label(t,r):{entry:t,compsArr:r},o=n.merge(e);n.buildStyles(o.style),n.appMarkup.innerHTML=o.template,setTimeout(function(){n.active(n.getRoute()),n.to();var r=Object.keys(o.script);(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;o.script[r[t]](),t===r.length-1&&c(n.viewLoaded)&&(dispatchEvent(n.viewLoaded),l("viewLoaded")),t+1<=r.length-1&&e(t+1)})()},0)},a()?Promise.resolve().then(function(){return _interopRequireWildcard(require("/devtool.js"))}).then(function(e){e=new e.default(n.appMarkup,n.rootCompName);o(e)}).catch(function(){return y(d,"warn")}):o()):console.error("".concat(f," ").concat("“View argument”"," is missing or it's not a constructor function! @ Olum.inject(View)"))}},{key:"buildStyles",value:function(e){var t="olum_style_tag",r=document.getElementById(t);r||((r=document.createElement("style")).id=t,document.head.append(r)),r.innerHTML=e}},{key:"merge",value:function(e){var a=this,t=e.entry,e=e.compsArr,i=t.template||"",c=t.style||"",u={};return t.render&&(u[0]=t.render),n(e)&&e.forEach(function(e,t){var r=e.child.data,o=r.template||"",n=r.style||"",e=r.render||null,r=null!==a.prefix?a.prefix+"-"+r.name:r.name,r=new RegExp("<(".concat(r,"\\s{0,})\\/>"),"gi");i=i.replace(r,o),c+=n,null!==e&&(u[t+1]=e)}),{template:i,style:c,script:u}}}]),i}(),$:v,debug:y}});